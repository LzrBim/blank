jQuery.validator.addMethod("slug",function(t,e){return this.optional(e)||/^[a-z0-9\-]+$/.test(t)},"Lower case letters, numbers and hyphens only please.  No white space.");var tpjc=tpjc||{},tpjc=function(t,e){"use strict";return e.init=function(e,i){this.mode=e;var a={validateRules:"",model:"",useTinyAbsolutePath:!1};this.options=t.extend(a,i),this.settings={HTTP_PATH:window.location.protocol+"//"+window.location.hostname},this.tLog("MODE = "+this.mode);var n="";t.each(this.options,function(t,e){n+=t+" = "+e+", "}),this.tLog("OPTIONS = "+n),"undefined"!=typeof this.mode&&""!==this.mode?"index"==this.mode?this.index():"edit"==this.mode||"add"==this.mode?this.edit():"editRank"==this.mode?this.attach_sortable():"login"==this.mode?this.attach_login():("dashboard"==this.mode&&this.dashboard(),"search"==this.mode&&this.index(),"AdminUser"==this.options.model&&"editPassword"==this.mode&&(this.attach_admin_user_change_password(),this.attach_validator()),"AccountUser"==this.options.model&&"editPassword"==this.mode&&(this.attach_account_user_change_password(),this.attach_validator()),"Curated"==this.options.model&&("addImages"==this.mode&&(this.set_algolia_client(),this.bind_curated_add_images()),"reviewImages"==this.mode&&(this.set_algolia_client(),this.bind_curated_review_images()),"thumbRank"==this.mode&&this.attach_curated_sortable()),"Gallery"==this.options.model&&("addImages"==this.mode&&(this.brief_gallery_add_images(),this.attach_brief_gallery_file_name_add_modal()),"reviewImages"==this.mode&&this.brief_gallery_review_images(),"thumbRank"==this.mode&&this.attach_brief_gallery_sortable(0),"thumbRankFeatured"==this.mode&&this.attach_brief_gallery_sortable(1))):this.tLog("tpjc::init() - no mode"),this.defaults()},tpjc.defaults=function(){var e=this;e.tLog("- defaults()"),t(".alert").alert(),t("#side-menu").metisMenu(),t(window).bind("load resize",function(){var e=50,i=this.window.innerWidth>0?this.window.innerWidth:this.screen.width;768>i?(t("div.navbar-collapse").addClass("collapse"),e=100):t("div.navbar-collapse").removeClass("collapse");var a=(this.window.innerHeight>0?this.window.innerHeight:this.screen.height)-1;a-=e,1>a&&(a=1),a>e&&t("#page-wrapper").css("min-height",a+"px")});var i=window.location,a=t("ul.nav a").filter(function(){return this.href===i||0===i.href.indexOf(this.href)}).addClass("active").parent().parent().addClass("in").parent();a.is("li")&&a.addClass("active")},e.index=function(){("Item"==this.options.model||"Post"==this.options.model)&&this.attach_toggle_featured()},e.edit=function(){this.attach_edit_page_model_option_overrides(),this.attach_editor(),this.attach_validator(),this.attach_edit_form_plugins(),this.attach_crop_button(),this.attach_remove_image(),this.attach_edit_form_submit_button_clicks(),this.attach_edit_page_model_options()},e.attach_edit_page_model_option_overrides=function(){this.tLog("- attach_edit_page_model_options()"),this.options.model.length&&"NewsletterBlock"==this.options.model&&(this.options.useTinyAbsolutePath=!0)},e.attach_edit_page_model_options=function(){this.tLog("- attach_edit_page_model_options()"),this.options.model.length&&("AdminUser"==this.options.model&&"add"==this.mode&&this.attach_admin_user_add_validate(),"AccountUser"==this.options.model&&"edit"==this.mode&&this.attach_account_user_group_tag_modal(),"AccountUserGroup"==this.options.model&&"edit"==this.mode&&(this.attach_add_account_user_modal(),this.attach_account_user_group_remove()),"Discount"==this.options.model&&this.validate_add_discount_form(),"EmailTemplate"==this.options.model&&this.attach_email_template_test_modal(),"Faq"==this.options.model&&(this.attach_faq_tag_modal(),this.attach_simple_editor()),"Gallery"==this.options.model&&("add"==this.mode?this.gallery_add_type_select():(this.form_change_monitor(),this.attach_remove_gallery_image())),"Brief"==this.options.model&&this.attach_remove_gallery_image(),"Menu"==this.options.model&&(this.attach_menu_item_modal(),t("#nestable").nestable({group:1}).on("change",function(){t("#nestableInput").val(JSON.stringify(t("#nestable").nestable("serialize")))}).trigger("change")),"Page"==this.options.model&&"edit"==this.mode,"PageVersion"==this.options.model&&(this.attach_add_page_version_block_modal(),this.attach_insert_page_version_block_modal(),this.attach_remove_page_version_block(),this.attach_page_version_block_sortable()),"PageVersionBlock"==this.options.model&&(this.options.useTinyAbsolutePath=!0),"Slider"==this.options.model&&this.attach_simple_editor())},e.attach_login=function(){this.tLog("- attach_login()");var e=this;this.set_validator_defaults(),t("#loginForm").validate({rules:{email:{required:!0,email:!0},password:{required:!0,minlength:5}},onkeyup:!1}),t("#forgotPasswordForm").validate({rules:{email:{required:!0,email:!0}}}),t("#resetPasswordForm").validate({rules:{password:{required:!0,minlength:5}}}),t("#forgotPasswordButton").click(function(){return t("#loginFormContainer").slideUp("slow",function(){t("#forgotPasswordFormContainer").removeClass("hide").show(600)}),!1}),t("#backToLoginButton").click(function(){return t("#forgotPasswordFormContainer").slideUp("slow",function(){t("#loginFormContainer").show("slow")}),!1}),"undefined"!=typeof e.options.isForgotPassword&&t("#forgotPasswordButton").click()},e.tLog=function(t){"undefined"!=typeof console&&console.log(t)},e}($,tpjc);!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){t.extend(t.fn,{validate:function(e){if(!this.length)return void(e&&e.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));var i=t.data(this[0],"validator");return i?i:(this.attr("novalidate","novalidate"),i=new t.validator(e,this[0]),t.data(this[0],"validator",i),i.settings.onsubmit&&(this.on("click.validate",":submit",function(e){i.settings.submitHandler&&(i.submitButton=e.target),t(this).hasClass("cancel")&&(i.cancelSubmit=!0),void 0!==t(this).attr("formnovalidate")&&(i.cancelSubmit=!0)}),this.on("submit.validate",function(e){function a(){var a,n;return i.settings.submitHandler?(i.submitButton&&(a=t("<input type='hidden'/>").attr("name",i.submitButton.name).val(t(i.submitButton).val()).appendTo(i.currentForm)),n=i.settings.submitHandler.call(i,i.currentForm,e),i.submitButton&&a.remove(),void 0!==n?n:!1):!0}return i.settings.debug&&e.preventDefault(),i.cancelSubmit?(i.cancelSubmit=!1,a()):i.form()?i.pendingRequest?(i.formSubmitted=!0,!1):a():(i.focusInvalid(),!1)})),i)},valid:function(){var e,i,a;return t(this[0]).is("form")?e=this.validate().form():(a=[],e=!0,i=t(this[0].form).validate(),this.each(function(){e=i.element(this)&&e,a=a.concat(i.errorList)}),i.errorList=a),e},rules:function(e,i){var a,n,s,o,r,l,d=this[0];if(e)switch(a=t.data(d.form,"validator").settings,n=a.rules,s=t.validator.staticRules(d),e){case"add":t.extend(s,t.validator.normalizeRule(i)),delete s.messages,n[d.name]=s,i.messages&&(a.messages[d.name]=t.extend(a.messages[d.name],i.messages));break;case"remove":return i?(l={},t.each(i.split(/\s/),function(e,i){l[i]=s[i],delete s[i],"required"===i&&t(d).removeAttr("aria-required")}),l):(delete n[d.name],s)}return o=t.validator.normalizeRules(t.extend({},t.validator.classRules(d),t.validator.attributeRules(d),t.validator.dataRules(d),t.validator.staticRules(d)),d),o.required&&(r=o.required,delete o.required,o=t.extend({required:r},o),t(d).attr("aria-required","true")),o.remote&&(r=o.remote,delete o.remote,o=t.extend(o,{remote:r})),o}}),t.extend(t.expr[":"],{blank:function(e){return!t.trim(""+t(e).val())},filled:function(e){return!!t.trim(""+t(e).val())},unchecked:function(e){return!t(e).prop("checked")}}),t.validator=function(e,i){this.settings=t.extend(!0,{},t.validator.defaults,e),this.currentForm=i,this.init()},t.validator.format=function(e,i){return 1===arguments.length?function(){var i=t.makeArray(arguments);return i.unshift(e),t.validator.format.apply(this,i)}:(arguments.length>2&&i.constructor!==Array&&(i=t.makeArray(arguments).slice(1)),i.constructor!==Array&&(i=[i]),t.each(i,function(t,i){e=e.replace(new RegExp("\\{"+t+"\\}","g"),function(){return i})}),e)},t.extend(t.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusCleanup:!1,focusInvalid:!0,errorContainer:t([]),errorLabelContainer:t([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(t){this.lastActive=t,this.settings.focusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,t,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(t)))},onfocusout:function(t){this.checkable(t)||!(t.name in this.submitted)&&this.optional(t)||this.element(t)},onkeyup:function(e,i){var a=[16,17,18,20,35,36,37,38,39,40,45,144,225];9===i.which&&""===this.elementValue(e)||-1!==t.inArray(i.keyCode,a)||(e.name in this.submitted||e===this.lastElement)&&this.element(e)},onclick:function(t){t.name in this.submitted?this.element(t):t.parentNode.name in this.submitted&&this.element(t.parentNode)},highlight:function(e,i,a){"radio"===e.type?this.findByName(e.name).addClass(i).removeClass(a):t(e).addClass(i).removeClass(a)},unhighlight:function(e,i,a){"radio"===e.type?this.findByName(e.name).removeClass(i).addClass(a):t(e).removeClass(i).addClass(a)}},setDefaults:function(e){t.extend(t.validator.defaults,e)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date ( ISO ).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:t.validator.format("Please enter no more than {0} characters."),minlength:t.validator.format("Please enter at least {0} characters."),rangelength:t.validator.format("Please enter a value between {0} and {1} characters long."),range:t.validator.format("Please enter a value between {0} and {1}."),max:t.validator.format("Please enter a value less than or equal to {0}."),min:t.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function e(e){var i=t.data(this.form,"validator"),a="on"+e.type.replace(/^validate/,""),n=i.settings;n[a]&&!t(this).is(n.ignore)&&n[a].call(i,this,e)}this.labelContainer=t(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||t(this.currentForm),this.containers=t(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var i,a=this.groups={};t.each(this.settings.groups,function(e,i){"string"==typeof i&&(i=i.split(/\s/)),t.each(i,function(t,i){a[i]=e})}),i=this.settings.rules,t.each(i,function(e,a){i[e]=t.validator.normalizeRule(a)}),t(this.currentForm).on("focusin.validate focusout.validate keyup.validate",":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'], [type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox']",e).on("click.validate","select, option, [type='radio'], [type='checkbox']",e),this.settings.invalidHandler&&t(this.currentForm).on("invalid-form.validate",this.settings.invalidHandler),t(this.currentForm).find("[required], [data-rule-required], .required").attr("aria-required","true")},form:function(){return this.checkForm(),t.extend(this.submitted,this.errorMap),this.invalid=t.extend({},this.errorMap),this.valid()||t(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var t=0,e=this.currentElements=this.elements();e[t];t++)this.check(e[t]);return this.valid()},element:function(e){var i=this.clean(e),a=this.validationTargetFor(i),n=!0;return this.lastElement=a,void 0===a?delete this.invalid[i.name]:(this.prepareElement(a),this.currentElements=t(a),n=this.check(a)!==!1,n?delete this.invalid[a.name]:this.invalid[a.name]=!0),t(e).attr("aria-invalid",!n),this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),n},showErrors:function(e){if(e){t.extend(this.errorMap,e),this.errorList=[];for(var i in e)this.errorList.push({message:e[i],element:this.findByName(i)[0]});this.successList=t.grep(this.successList,function(t){return!(t.name in e)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){t.fn.resetForm&&t(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors();var e,i=this.elements().removeData("previousValue").removeAttr("aria-invalid");if(this.settings.unhighlight)for(e=0;i[e];e++)this.settings.unhighlight.call(this,i[e],this.settings.errorClass,"");else i.removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(t){var e,i=0;for(e in t)i++;return i},hideErrors:function(){this.hideThese(this.toHide)},hideThese:function(t){t.not(this.containers).text(""),this.addWrapper(t).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{t(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var e=this.lastActive;return e&&1===t.grep(this.errorList,function(t){return t.element.name===e.name}).length&&e},elements:function(){var e=this,i={};return t(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, :disabled").not(this.settings.ignore).filter(function(){return!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in i||!e.objectLength(t(this).rules())?!1:(i[this.name]=!0,!0)})},clean:function(e){return t(e)[0]},errors:function(){var e=this.settings.errorClass.split(" ").join(".");return t(this.settings.errorElement+"."+e,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=t([]),this.toHide=t([]),this.currentElements=t([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(t){this.reset(),this.toHide=this.errorsFor(t)},elementValue:function(e){var i,a=t(e),n=e.type;return"radio"===n||"checkbox"===n?this.findByName(e.name).filter(":checked").val():"number"===n&&"undefined"!=typeof e.validity?e.validity.badInput?!1:a.val():(i=a.val(),"string"==typeof i?i.replace(/\r/g,""):i)},check:function(e){e=this.validationTargetFor(this.clean(e));var i,a,n,s=t(e).rules(),o=t.map(s,function(t,e){return e}).length,r=!1,l=this.elementValue(e);for(a in s){n={method:a,parameters:s[a]};try{if(i=t.validator.methods[a].call(this,l,e,n.parameters),"dependency-mismatch"===i&&1===o){r=!0;continue}if(r=!1,"pending"===i)return void(this.toHide=this.toHide.not(this.errorsFor(e)));if(!i)return this.formatAndAdd(e,n),!1}catch(d){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+e.id+", check the '"+n.method+"' method.",d),d instanceof TypeError&&(d.message+=".  Exception occurred when checking element "+e.id+", check the '"+n.method+"' method."),d}}return r?void 0:(this.objectLength(s)&&this.successList.push(e),!0)},customDataMessage:function(e,i){return t(e).data("msg"+i.charAt(0).toUpperCase()+i.substring(1).toLowerCase())||t(e).data("msg")},customMessage:function(t,e){var i=this.settings.messages[t];return i&&(i.constructor===String?i:i[e])},findDefined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t];return void 0},defaultMessage:function(e,i){return this.findDefined(this.customMessage(e.name,i),this.customDataMessage(e,i),!this.settings.ignoreTitle&&e.title||void 0,t.validator.messages[i],"<strong>Warning: No message defined for "+e.name+"</strong>")},formatAndAdd:function(e,i){var a=this.defaultMessage(e,i.method),n=/\$?\{(\d+)\}/g;"function"==typeof a?a=a.call(this,i.parameters,e):n.test(a)&&(a=t.validator.format(a.replace(n,"{$1}"),i.parameters)),this.errorList.push({message:a,element:e,method:i.method}),this.errorMap[e.name]=a,this.submitted[e.name]=a},addWrapper:function(t){return this.settings.wrapper&&(t=t.add(t.parent(this.settings.wrapper))),t},defaultShowErrors:function(){var t,e,i;for(t=0;this.errorList[t];t++)i=this.errorList[t],this.settings.highlight&&this.settings.highlight.call(this,i.element,this.settings.errorClass,this.settings.validClass),this.showLabel(i.element,i.message);if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(t=0;this.successList[t];t++)this.showLabel(this.successList[t]);if(this.settings.unhighlight)for(t=0,e=this.validElements();e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return t(this.errorList).map(function(){return this.element})},showLabel:function(e,i){var a,n,s,o=this.errorsFor(e),r=this.idOrName(e),l=t(e).attr("aria-describedby");o.length?(o.removeClass(this.settings.validClass).addClass(this.settings.errorClass),o.html(i)):(o=t("<"+this.settings.errorElement+">").attr("id",r+"-error").addClass(this.settings.errorClass).html(i||""),a=o,this.settings.wrapper&&(a=o.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.length?this.labelContainer.append(a):this.settings.errorPlacement?this.settings.errorPlacement(a,t(e)):a.insertAfter(e),o.is("label")?o.attr("for",r):0===o.parents("label[for='"+r+"']").length&&(s=o.attr("id").replace(/(:|\.|\[|\]|\$)/g,"\\$1"),l?l.match(new RegExp("\\b"+s+"\\b"))||(l+=" "+s):l=s,t(e).attr("aria-describedby",l),n=this.groups[e.name],n&&t.each(this.groups,function(e,i){i===n&&t("[name='"+e+"']",this.currentForm).attr("aria-describedby",o.attr("id"))}))),!i&&this.settings.success&&(o.text(""),"string"==typeof this.settings.success?o.addClass(this.settings.success):this.settings.success(o,e)),this.toShow=this.toShow.add(o)},errorsFor:function(e){var i=this.idOrName(e),a=t(e).attr("aria-describedby"),n="label[for='"+i+"'], label[for='"+i+"'] *";return a&&(n=n+", #"+a.replace(/\s+/g,", #")),this.errors().filter(n)},idOrName:function(t){return this.groups[t.name]||(this.checkable(t)?t.name:t.id||t.name)},validationTargetFor:function(e){return this.checkable(e)&&(e=this.findByName(e.name)),t(e).not(this.settings.ignore)[0]},checkable:function(t){return/radio|checkbox/i.test(t.type)},findByName:function(e){return t(this.currentForm).find("[name='"+e+"']")},getLength:function(e,i){switch(i.nodeName.toLowerCase()){case"select":return t("option:selected",i).length;case"input":if(this.checkable(i))return this.findByName(i.name).filter(":checked").length}return e.length},depend:function(t,e){return this.dependTypes[typeof t]?this.dependTypes[typeof t](t,e):!0},dependTypes:{"boolean":function(t){return t},string:function(e,i){return!!t(e,i.form).length},"function":function(t,e){return t(e)}},optional:function(e){var i=this.elementValue(e);return!t.validator.methods.required.call(this,i,e)&&"dependency-mismatch"},startRequest:function(t){this.pending[t.name]||(this.pendingRequest++,this.pending[t.name]=!0)},stopRequest:function(e,i){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[e.name],i&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(t(this.currentForm).submit(),this.formSubmitted=!1):!i&&0===this.pendingRequest&&this.formSubmitted&&(t(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(e){return t.data(e,"previousValue")||t.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,"remote")})},destroy:function(){this.resetForm(),t(this.currentForm).off(".validate").removeData("validator")}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(e,i){e.constructor===String?this.classRuleSettings[e]=i:t.extend(this.classRuleSettings,e)},classRules:function(e){var i={},a=t(e).attr("class");return a&&t.each(a.split(" "),function(){this in t.validator.classRuleSettings&&t.extend(i,t.validator.classRuleSettings[this])}),i},normalizeAttributeRule:function(t,e,i,a){/min|max/.test(i)&&(null===e||/number|range|text/.test(e))&&(a=Number(a),isNaN(a)&&(a=void 0)),a||0===a?t[i]=a:e===i&&"range"!==e&&(t[i]=!0)},attributeRules:function(e){var i,a,n={},s=t(e),o=e.getAttribute("type");for(i in t.validator.methods)"required"===i?(a=e.getAttribute(i),""===a&&(a=!0),a=!!a):a=s.attr(i),this.normalizeAttributeRule(n,o,i,a);return n.maxlength&&/-1|2147483647|524288/.test(n.maxlength)&&delete n.maxlength,n},dataRules:function(e){var i,a,n={},s=t(e),o=e.getAttribute("type");for(i in t.validator.methods)a=s.data("rule"+i.charAt(0).toUpperCase()+i.substring(1).toLowerCase()),this.normalizeAttributeRule(n,o,i,a);return n},staticRules:function(e){var i={},a=t.data(e.form,"validator");return a.settings.rules&&(i=t.validator.normalizeRule(a.settings.rules[e.name])||{}),i},normalizeRules:function(e,i){return t.each(e,function(a,n){if(n===!1)return void delete e[a];if(n.param||n.depends){var s=!0;switch(typeof n.depends){case"string":s=!!t(n.depends,i.form).length;break;case"function":s=n.depends.call(i,i)}s?e[a]=void 0!==n.param?n.param:!0:delete e[a]}}),t.each(e,function(a,n){e[a]=t.isFunction(n)?n(i):n}),t.each(["minlength","maxlength"],function(){e[this]&&(e[this]=Number(e[this]))}),t.each(["rangelength","range"],function(){var i;e[this]&&(t.isArray(e[this])?e[this]=[Number(e[this][0]),Number(e[this][1])]:"string"==typeof e[this]&&(i=e[this].replace(/[\[\]]/g,"").split(/[\s,]+/),e[this]=[Number(i[0]),Number(i[1])]))}),t.validator.autoCreateRanges&&(null!=e.min&&null!=e.max&&(e.range=[e.min,e.max],delete e.min,delete e.max),null!=e.minlength&&null!=e.maxlength&&(e.rangelength=[e.minlength,e.maxlength],delete e.minlength,delete e.maxlength)),e},normalizeRule:function(e){if("string"==typeof e){var i={};t.each(e.split(/\s/),function(){i[this]=!0}),e=i}return e},addMethod:function(e,i,a){t.validator.methods[e]=i,t.validator.messages[e]=void 0!==a?a:t.validator.messages[e],i.length<3&&t.validator.addClassRules(e,t.validator.normalizeRule(e))},methods:{required:function(e,i,a){if(!this.depend(a,i))return"dependency-mismatch";if("select"===i.nodeName.toLowerCase()){var n=t(i).val();return n&&n.length>0}return this.checkable(i)?this.getLength(e,i)>0:e.length>0},email:function(t,e){return this.optional(e)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)},url:function(t,e){return this.optional(e)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(t)},number:function(t,e){return this.optional(e)||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},creditcard:function(t,e){if(this.optional(e))return"dependency-mismatch";if(/[^0-9 \-]+/.test(t))return!1;var i,a,n=0,s=0,o=!1;if(t=t.replace(/\D/g,""),t.length<13||t.length>19)return!1;for(i=t.length-1;i>=0;i--)a=t.charAt(i),s=parseInt(a,10),o&&(s*=2)>9&&(s-=9),n+=s,o=!o;return n%10===0},minlength:function(e,i,a){var n=t.isArray(e)?e.length:this.getLength(e,i);return this.optional(i)||n>=a},maxlength:function(e,i,a){var n=t.isArray(e)?e.length:this.getLength(e,i);return this.optional(i)||a>=n},rangelength:function(e,i,a){var n=t.isArray(e)?e.length:this.getLength(e,i);return this.optional(i)||n>=a[0]&&n<=a[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(e,i,a){var n=t(a);return this.settings.onfocusout&&n.off(".validate-equalTo").on("blur.validate-equalTo",function(){t(i).valid()}),e===n.val()},remote:function(e,i,a){if(this.optional(i))return"dependency-mismatch";var n,s,o=this.previousValue(i);return this.settings.messages[i.name]||(this.settings.messages[i.name]={}),o.originalMessage=this.settings.messages[i.name].remote,this.settings.messages[i.name].remote=o.message,a="string"==typeof a&&{url:a}||a,o.old===e?o.valid:(o.old=e,n=this,this.startRequest(i),s={},s[i.name]=e,t.ajax(t.extend(!0,{mode:"abort",port:"validate"+i.name,dataType:"json",data:s,context:n.currentForm,success:function(a){var s,r,l,d=a===!0||"true"===a;n.settings.messages[i.name].remote=o.originalMessage,d?(l=n.formSubmitted,n.prepareElement(i),n.formSubmitted=l,n.successList.push(i),delete n.invalid[i.name],n.showErrors()):(s={},r=a||n.defaultMessage(i,"remote"),s[i.name]=o.message=t.isFunction(r)?r(e):r,n.invalid[i.name]=!0,n.showErrors(s)),o.valid=d,n.stopRequest(i,d)}},a)),"pending")}}});var e,i={};t.ajaxPrefilter?t.ajaxPrefilter(function(t,e,a){var n=t.port;"abort"===t.mode&&(i[n]&&i[n].abort(),i[n]=a)}):(e=t.ajax,t.ajax=function(a){var n=("mode"in a?a:t.ajaxSettings).mode,s=("port"in a?a:t.ajaxSettings).port;return"abort"===n?(i[s]&&i[s].abort(),i[s]=e.apply(this,arguments),i[s]):e.apply(this,arguments)})}),!function(t){"use strict";function e(){var t=document.createElement("mm"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}function i(e){return this.each(function(){var i=t(this),a=i.data("mm"),s=t.extend({},n.DEFAULTS,i.data(),"object"==typeof e&&e);a||i.data("mm",a=new n(this,s)),"string"==typeof e&&a[e]()})}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("mmTransitionEnd",function(){i=!0});var s=function(){i||t(n).trigger(a.end)};return setTimeout(s,e),this};var a=e();a&&(t.event.special.mmTransitionEnd={bindType:a.end,delegateType:a.end,handle:function(e){return t(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}});var n=function(e,i){this.$element=t(e),this.options=t.extend({},n.DEFAULTS,i),this.transitioning=null,this.init()};n.TRANSITION_DURATION=350,n.DEFAULTS={toggle:!0,doubleTapToGo:!1,preventDefault:!0,activeClass:"active",collapseClass:"collapse",collapseInClass:"in",collapsingClass:"collapsing",onTransitionStart:!1,onTransitionEnd:!1},n.prototype.init=function(){var e=this,i=this.options.activeClass,a=this.options.collapseClass,n=this.options.collapseInClass;this.$element.find("li."+i).has("ul").children("ul").attr("aria-expanded",!0).addClass(a+" "+n),this.$element.find("li").not("."+i).has("ul").children("ul").attr("aria-expanded",!1).addClass(a),this.options.doubleTapToGo&&this.$element.find("li."+i).has("ul").children("a").addClass("doubleTapToGo"),this.$element.find("li").has("ul").children("a").on("click.metisMenu",function(a){var n=t(this),s=n.parent("li"),o=s.children("ul");return e.options.preventDefault&&a.preventDefault(),s.hasClass(i)&&!e.options.doubleTapToGo?(e.hide(o),n.attr("aria-expanded",!1)):(e.show(o),n.attr("aria-expanded",!0)),e.options.onTransitionStart&&e.options.onTransitionStart(),e.options.doubleTapToGo&&e.doubleTapToGo(n)&&"#"!==n.attr("href")&&""!==n.attr("href")?(a.stopPropagation(),void(document.location=n.attr("href"))):void 0})},n.prototype.doubleTapToGo=function(t){var e=this.$element;return t.hasClass("doubleTapToGo")?(t.removeClass("doubleTapToGo"),!0):t.parent().children("ul").length?(e.find(".doubleTapToGo").removeClass("doubleTapToGo"),t.addClass("doubleTapToGo"),!1):void 0},n.prototype.show=function(e){var i=this.options.activeClass,s=this.options.collapseClass,o=this.options.collapseInClass,r=this.options.collapsingClass,l=t(e),d=l.parent("li");if(!this.transitioning&&!l.hasClass(o)){d.addClass(i),this.options.toggle&&this.hide(d.siblings().children("ul."+o).attr("aria-expanded",!1)),l.removeClass(s).addClass(r).height(0),this.transitioning=1;var c=function(){this.transitioning&&this.options.onTransitionEnd&&this.options.onTransitionEnd(),l.removeClass(r).addClass(s+" "+o).height("").attr("aria-expanded",!0),this.transitioning=0};return a?void l.one("mmTransitionEnd",t.proxy(c,this)).emulateTransitionEnd(n.TRANSITION_DURATION).height(l[0].scrollHeight):c.call(this)}},n.prototype.hide=function(e){var i=this.options.activeClass,s=this.options.collapseClass,o=this.options.collapseInClass,r=this.options.collapsingClass,l=t(e);if(!this.transitioning&&l.hasClass(o)){l.parent("li").removeClass(i),l.height(l.height())[0].offsetHeight,l.addClass(r).removeClass(s).removeClass(o),this.transitioning=1;var d=function(){this.transitioning&&this.options.onTransitionEnd&&this.options.onTransitionEnd(),this.transitioning=0,l.removeClass(r).addClass(s).attr("aria-expanded",!1)};return a?void l.height(0).one("mmTransitionEnd",t.proxy(d,this)).emulateTransitionEnd(n.TRANSITION_DURATION):d.call(this)}};var s=t.fn.metisMenu;t.fn.metisMenu=i,t.fn.metisMenu.Constructor=n,t.fn.metisMenu.noConflict=function(){return t.fn.metisMenu=s,this}}(jQuery);var tpjc=tpjc||{};tpjc.attach_edit_form_plugins=function(){this.tLog("- attach_edit_form_plugins()"),$(".hoverControlsContainer").hover(function(){$(this).find(".hoverControls").fadeIn(100)},function(){$(this).find(".hoverControls").fadeOut(300)})},tpjc.attach_result_table_checkboxes=function(){$(".checkAllButton").click(function(){return $(".resultFormCheckBox").prop("checked",!0),!1}),$(".unCheckAllButton").click(function(){return $(".resultFormCheckBox").prop("checked",!1),!1})},tpjc.checkbox_group_action=function(){var t="Are you sure you wish to mark all items ";if("active"==action)t+="active";else if("inactive"==action)t+="inactive";else{if("delete"!=action)return this.tLog("Invalid group action = "+action),!1;t="Are you sure you wish to delete all checked items "}return confirm(t)?($("<input />").attr("type","hidden").attr("name","action").val(action).appendTo("#resultForm"),$("#resultForm").submit(),!0):!1},tpjc.attach_toggle_featured=function(){this.tLog("- attach_toggle_featured()");var t=this;$(".featuredButton").click(function(){var e=t.options.model,i=$(this),a=i.data("id"),n="toggle_featured";return $.ajax({type:"POST",url:"ajax/common.php",data:"&model="+e+"&id="+a+"&action="+n,dataType:"json",cache:!1,success:function(t){i.find("i").hasClass("glyphicon-star")?i.find("i").removeClass("glyphicon-star").addClass("glyphicon-star-empty"):i.find("i").removeClass("glyphicon-star-empty").addClass("glyphicon-star")},error:function(t,e,i){alert(i)}}),!1})},tpjc.form_change_monitor=function(){this.tLog("- form_change_monitor()");var t=this;t.hasChanged=!1;var e="#editForm input.form-control, #editForm textarea.form-control";$('a[data-tpjc-action="formChangeMonitorButton"]').length?(tinyMCE.triggerSave(),$(e).each(function(){$(this).data("initialValue",$(this).val())}),$('a[data-tpjc-action="formChangeMonitorButton"]').click(function(i){
return tinyMCE.triggerSave(),$(e).each(function(){$(this).data("initialValue")!=$(this).val()&&(t.tLog($(this).attr("name")+" initialValue = "+$(this).data("initialValue")+" new value = "+$(this).val()),t.hasChanged=!0)}),t.hasChanged?confirm("You have made changes to this item.  Are you sure you want to navigate away from this page?"):!0})):this.tLog('Cannot attach form change monitor without buttons with data-tpjc-action="formChangeMonitorButton"')},tpjc.attach_editor=function(){self=this,self.tLog("- attach_editor()");var t=!1,e=!0,i=!0,a=self.settings.HTTP_PATH;("local.cavanimages.com"==window.location.hostname||self.options.useTinyAbsolutePath)&&(t=!1,e=!1,i=!1),tinymce.init({relative_urls:t,convert_urls:e,remove_script_host:i,document_base_url:a,content_css:self.settings.HTTP_PATH+"css/style.css",selector:".tinyMCE",object_resizing:"img",style_formats:[{title:"Heading 2",block:"h2"},{title:"Heading 3",block:"h3"},{title:"Heading 4",block:"h4"},{title:"Heading 5",block:"h5"},{title:"Paragraph",block:"p"},{title:"Image Left",selector:"img",styles:{"float":"left",margin:"0 20px 0 20px"}},{title:"Image Right",selector:"img",styles:{"float":"right",margin:"0 0 20px 20px"}},{title:"Red",inline:"span",classes:"red"},{title:"Green",inline:"span",classes:"green"}],plugins:["advlist autolink lists link image charmap anchor searchreplace visualblocks code media table contextmenu paste"],image_advtab:!1,setup:function(t){t.addButton("tpjc_mediaButton",{title:"Add Video",icon:"mce-ico mce-i-media",onclick:function(){t.windowManager.open({title:"Insert Video",body:[{type:"label",text:"Embed Code",style:"font-weight:bold;"},{type:"textbox",name:"embedCode",minWidth:320,minHeight:150,multiline:!0,tooltip:"Paste the embed code obtained from Youtube Share => Embed"}],onsubmit:function(e){t.insertContent('<div class="video-responsive">'+e.data.embedCode+"</div>")}})}})},menubar:!1,toolbar:"bold italic | styleselect | alignleft aligncenter alignright | bullist table outdent indent hr | link unlink |  tpjc_mediaButton image | code",file_browser_callback:function(t,e,i,a){var n="";return n="file"==i?"File & Link Browser":"image"==i?"Image Browser":"Media",tinymce.activeEditor.windowManager.open({title:n,url:"js/file_browser/index.php",width:640,height:400,close_previous:"no",buttons:[{text:"Close",onclick:"close"}]},{field_name:t,type:i,win:a}),!1}})},tpjc.attach_simple_editor=function(){self=this,self.tLog("- attach_simpleEditor()");var t=!1,e=!0,i=!0,a=self.settings.HTTP_PATH;("10.0.1.2"==window.location.hostname||self.options.useTinyAbsolutePath)&&(t=!1,e=!1,i=!1),tinymce.init({relative_urls:t,convert_urls:e,remove_script_host:i,document_base_url:a,skin_url:"3e/js/tinymce/skins/tpSkin/",content_css:"3e/js/tinymce/style.css",selector:".simpleTinyMCE",plugins:["paste, code"],paste_as_text:!0,menubar:!1,toolbar:"bold italic | code"})},tpjc.set_validator_defaults=function(){self=this,self.tLog("- set_validator_defaults()"),$.validator.setDefaults({ignore:"",errorElement:"span",errorClass:"help-block",highlight:function(t){$(t).closest(".form-group").addClass("has-error")},unhighlight:function(t){$(t).closest(".form-group").removeClass("has-error")},errorPlacement:function(t,e){t.insertAfter(e.parent(".input-group").length?e.parent():e)},submitHandler:function(t){self.tLog("- - submitHandler called"),$.blockUI({message:$("#loading")}),t.submit()}})},tpjc.attach_validator=function(){if(self=this,self.tLog("- attach_validator()"),"undefined"!=typeof self.options.validateRules){self.set_validator_defaults();{$("#editForm").submit(function(){tinyMCE.triggerSave()}).validate(self.options.validateRules)}self.tLog("- - validate("+JSON.stringify(self.options.validateRules)+")")}else self.tLog("- - attaching submitHandler w/o validation"),$("#editForm").submit(function(){return self.tLog("- - submit() called"),$.blockUI({message:$("#loading")}),!0})},tpjc.attach_remove_image=function(){var t=this;t.tLog("- attach_remove_image()"),$('a[data-tpjc-action="removeImage"]').click(function(){t.tLog("removing image");var e=t.options.model,i=$(this),a=i.data("tpjc-id"),n="removeImage";return $.ajax({type:"POST",url:"ajax/common.php",data:"&model="+e+"&id="+a+"&action="+n,dataType:"json",cache:!1,success:function(t){return $('input[name="imageID"]').val(0),$("#editImage_main").fadeOut(600,function(){$("#editImage_thumb").fadeOut(400,function(){$(this).remove()}),$(this).remove()}),!1},error:function(t,e,i){alert(i)}}),!1})},tpjc.attach_remove_gallery_image=function(){this.tLog("- attach_remove_gallery_image()");$('a[data-tpjc-action="remove_gallery_image"]').click(function(){if(confirm("Are you sure you want to delete this image?")){var t=$(this),e=t.data("tpjc-model"),i=t.data("tpjc-id"),a="delete";return $.ajax({type:"POST",url:"ajax/common.php",data:"&model="+e+"&id="+i+"&action="+a,dataType:"json",cache:!1,success:function(t){$("#galleryImage_"+i).fadeOut(600,function(){$(this).remove()})},error:function(t,e,i){alert(i)}}),!1}return!1})},tpjc.modal_ajax_submit_handler=function(t,e){this.tLog("- modal_ajax_submit_handler()");var i=this,a=$("#"+t+"Form"),n=a.attr("action");i.show_modal_loading(t);var s=form.serialize()+"&xhr=1";$.ajax({type:"POST",url:n,data:s,dataType:$.browser.msie?"text":"json",accepts:{text:"application/json"},cache:!1,success:function(a){a.success?($("#"+t).modal("hide"),i.hide_modal_loading(t),i.tLog("- - json success"),e(a)):(i.show_modal_message(t,"error",a.message),i.hide_modal_loading(t),i.tLog("- - json did not return success"))},error:function(e){alert("An error occured while sending your message"),i.hide_modal_loading(t)}})},tpjc.attach_remove_gallery_image=function(){this.tLog("- close_all_popovers()"),$(".popOverButton").popover("hide")},tpjc.show_message=function(t,e){var i=this.format_alert_message(t,e);$("#tpjc_alert").html(i).alert()},tpjc.show_modal_loading=function(t){var e=$("#"+t);e.find("input[type=submit]").attr("disabled","disabled"),e.find(".modal-body").prepend('<div class="loadingOverlay"></div>').show()},tpjc.hide_modal_loading=function(t){var e=$("#"+t);e.find("input[type=submit]").attr("disabled","false"),e.find(".loadingOverlay").remove()},tpjc.show_modal_message=function(t,e,i){var a=this.format_alert_message(e,i);$("#"+t).find(".tpjc_modalAlert").html(a).alert()},tpjc.reset_form=function(t){var e=$("#"+t);e.find("input:text, input:password, input:file, select, textarea").val(""),e.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),e.find(".tpjc_modalAlert").html("")},tpjc.format_alert_message=function(t,e){"error"==t&&(t="danger");var i='<div class="alert alert-'+t+' alert-dismissable">';return i+='<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>',i+=e,i+="</div>"},tpjc.attach_crop_button=function(){this.tLog("- attach_crop_button()");$(".tpjc_cropButton").click(function(){var t,e=$(window).innerWidth(),i=$(window).innerWidth(),a="toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,";if(a+="width="+e+",height="+i,t=$(this).data(),"undefined"!=typeof t.model&&"undefined"!=typeof t.id&&"undefined"!=typeof t.type){url="js/jCrop/crop.php?model="+t.model+"&id="+t.id+"&type="+t.type;{window.open(url,"Crop",a)}}else alert("An error occured while building crop window");return!1})},tpjc.attach_edit_form_submit_button_clicks=function(){$("#quickSave").click(function(){return $("<input />").attr("type","hidden").attr("name","quickSave").val("1").appendTo("#editForm"),!0}),$("#goBack").click(function(){return $("<input />").attr("type","hidden").attr("name","goBack").val("1").appendTo("#editForm"),!0}),$("#saveAndAdd").click(function(){return $("<input />").attr("type","hidden").attr("name","saveAndAdd").val("1").appendTo("#editForm"),!0})},tpjc.attach_sortable=function(){this.tLog("- attach_sortable()");var t=this;$("#sortable").length?$("#sortable").sortable({placeholder:"dropZone",update:function(e,i){$.ajax({type:"POST",url:"ajax/editRank.php",data:$("#sortable").sortable("serialize")+"&model="+t.options.model,success:function(t){},error:function(t,e,i){alert(i)}})}}):t.tLog("WARNING - Nothing to sort")};var tpjc=tpjc||{};tpjc.dashboard=function(){self=this,self.tLog("Attaching queueBuildVersions"),$("#tpjc_queueBuildVersions").one("click",function(){var t=$(this);return $.ajax({type:"POST",url:"index.php",data:"&mode=queueBuildVersions",dataType:"json",cache:!1,success:function(e){e.success?t.removeClass("btn-success").addClass("btn-default").html('<img src="images/loading.gif" style="width:21px;"/>Processing').blur():t.removeClass("btn-success").addClass("btn-warning").html("Ouch...")},error:function(t,e,i){alert(i)}}),!1})};var tpjc=tpjc||{};tpjc.attach_account_user_group_tag_modal=function(){this.tLog("- attach_account_user_group_tag_modal()");var t=this,e="accountUserGroupTagModal";$("#"+e).children("form").validate({rules:{title:"required"},submitHandler:function(i){return t.modal_ajax_submit_handler(e,function(t){$("#accountUserGroupTagID").append('<option value="'+t.tagID+'" selected>'+t.title+"</option>"),$(".tpjc_multiSelect").trigger("chosen:updated")}),!1}})},tpjc.attach_faq_tag_modal=function(){this.tLog("- attach_faq_tag_modal()");var t=this,e="faqTagModal";$("#"+e).children("form").validate({rules:{title:"required"},submitHandler:function(i){return t.modal_ajax_submit_handler(e,function(t){$("#faqTagID").append('<option value="'+t.tagID+'" selected>'+t.title+"</option>"),$(".tpjc_multiSelect").trigger("chosen:updated")}),!1}})},tinymce.PluginManager.add("image",function(t){function e(t,e){function i(t,i){a.parentNode&&a.parentNode.removeChild(a),e({width:t,height:i})}var a=document.createElement("img");a.onload=function(){i(a.clientWidth,a.clientHeight)},a.onerror=function(){i()};var n=a.style;n.visibility="hidden",n.position="fixed",n.bottom=n.left=0,n.width=n.height="auto",document.body.appendChild(a),a.src=t}function i(t,e,i){function a(t,i){return i=i||[],tinymce.each(t,function(t){var n={text:t.text||t.title};t.menu?n.menu=a(t.menu):(n.value=t.value,e(n)),i.push(n)}),i}return a(t,i||[])}function a(e){return function(){var i=t.settings.image_list;"string"==typeof i?tinymce.util.XHR.send({url:i,success:function(t){e(tinymce.util.JSON.parse(t))}}):"function"==typeof i?i(e):e(i)}}function n(a){function n(){var t,e,i,a;t=d.find("#width")[0],e=d.find("#height")[0],t&&e&&(i=t.value(),a=e.value(),d.find("#constrain")[0].checked()&&c&&u&&i&&a&&(c!=i?(a=Math.round(i/c*a),e.value(a)):(i=Math.round(a/u*i),t.value(i))),c=i,u=a)}function s(){function e(e){function i(){e.onload=e.onerror=null,t.selection&&(t.selection.select(e),t.nodeChanged())}e.onload=function(){p.width||p.height||!v||g.setAttribs(e,{width:e.clientWidth,height:e.clientHeight}),i()},e.onerror=i}l(),n(),p=tinymce.extend(p,d.toJSON()),p.alt||(p.alt=""),""===p.width&&(p.width=null),""===p.height&&(p.height=null),p.style||(p.style=null),p={src:p.src,alt:p.alt,width:p.width,height:p.height,style:p.style,"class":p["class"]},"responsive"==d.find("#tpjc_sizes")[0].value()&&(p["class"]="img-responsive"),"newsletterColumn"==d.find("#tpjc_sizes")[0].value()&&(p.width=240),"newsletterWide"==d.find("#tpjc_sizes")[0].value()&&(p.width=638),t.undoManager.transact(function(){return p.src?(f?g.setAttribs(f,p):(p.id="__mcenew",t.focus(),t.selection.setContent(g.createHTML("img",p)),f=g.get("__mcenew"),g.setAttrib(f,"id",null)),void e(f)):void(f&&(g.remove(f),t.focus(),t.nodeChanged()))})}function o(t){return t&&(t=t.replace(/px$/,"")),t}function r(i){var a=i.meta||{};h&&h.value(t.convertURL(this.value(),"src")),tinymce.each(a,function(t,e){d.find("#"+e).value(t)}),a.width||a.height||e(this.value(),function(t){t.width&&t.height&&v&&(c=t.width,u=t.height,d.find("#width").value(c),d.find("#height").value(u))})}function l(){function e(t){return t.length>0&&/^[0-9]+$/.test(t)&&(t+="px"),t}if(t.settings.image_advtab){var i=d.toJSON(),a=g.parseStyle(i.style);delete a.margin,a["margin-top"]=a["margin-bottom"]=e(i.vspace),a["margin-left"]=a["margin-right"]=e(i.hspace),a["border-width"]=e(i.border),d.find("#style").value(g.serializeStyle(g.parseStyle(g.serializeStyle(a))))}}var d,c,u,h,m,p={},g=t.dom,f=t.selection.getNode(),v=t.settings.image_dimensions!==!1;c=g.getAttrib(f,"width"),u=g.getAttrib(f,"height"),"IMG"!=f.nodeName||f.getAttribute("data-mce-object")||f.getAttribute("data-mce-placeholder")?f=null:p={src:g.getAttrib(f,"src"),alt:g.getAttrib(f,"alt"),"class":g.getAttrib(f,"class"),width:c,height:u},a&&(h={type:"listbox",label:"Image list",values:i(a,function(e){e.value=t.convertURL(e.value||e.url,"src")},[{text:"None",value:""}]),value:p.src&&t.convertURL(p.src,"src"),onselect:function(t){var e=d.find("#alt");(!e.value()||t.lastControl&&e.value()==t.lastControl.text())&&e.value(t.control.text()),d.find("#src").value(t.control.value()).fire("change")},onPostRender:function(){h=this}}),t.settings.image_class_list&&(m={name:"class",type:"listbox",label:"Class",values:i(t.settings.image_class_list,function(e){e.value&&(e.textStyle=function(){return t.formatter.getCssText({inline:"img",classes:[e.value]})})})});var _=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:r},h];_.push({label:"Sizes",name:"tpjc_sizes",layout:"flex",direction:"row",align:"left",spacing:5,type:"listbox",values:[{value:"",text:""},{value:"responsive",text:"Full Width"},{value:"newsletterColumn",text:"Newsletter Column"},{value:"newsletterWide",text:"Wide Newsletter"}]}),t.settings.image_description!==!1&&_.push({name:"alt",type:"textbox",label:"Image description"}),v&&_.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:n,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:n,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),_.push(m),t.settings.image_advtab?(f&&(p.hspace=o(f.style.marginLeft||f.style.marginRight),p.vspace=o(f.style.marginTop||f.style.marginBottom),p.border=o(f.style.borderWidth),p.style=t.dom.serializeStyle(t.dom.parseStyle(t.dom.getAttrib(f,"style")))),d=t.windowManager.open({title:"Insert/Edit image",data:p,bodyType:"tabpanel",body:[{title:"General",type:"form",items:_},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:l},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:s})):d=t.windowManager.open({title:"Insert/edit image",data:p,body:_,onSubmit:s})}t.addButton("image",{icon:"image",tooltip:"Insert/Edit image",onclick:a(n),stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"}),t.addMenuItem("image",{icon:"image",text:"Insert Image",onclick:a(n),context:"insert",prependToContext:!0}),t.addCommand("mceImage",a(n))});var tpjc=tpjc||{};tpjc.attach_menu_item_modal=function(){var t=this;t.tLog("- - attach_menu_item_modal()"),t.set_validator_defaults();var e="ajaxForm",i="menuItemModal",a=$("#"+e).attr("action");$("#"+e).validate({rules:{title:"required"},submitHandler:function(n){t.show_modal_loading(e);var s=$("#"+e).serialize();return $.ajax({type:"POST",url:a,data:s,dataType:"json",cache:!1,success:function(a){$("#"+i).modal("hide"),t.reset_form(i),$("#type_1").prop("checked",!0),$("input[name=type]").change();var n='<li class="dd-item';n+=0===a.pageID&&""===a.href?" dd-dropDown":" dd-noChild",n+='" data-id="'+a.menuItemID+'"><div class="dd-handle">'+a.title,0===a.pageID&&""===a.href&&(n+=' <span class="glyphicon glyphicon-chevron-down sm"></span> '),n+='</div><button class="nestableRemove" data-action="remove" type="button"><i class="glyphicon glyphicon-remove"></i></button></li>',$("#nestable > ol").append(n),$("#nestableInput").val(JSON.stringify($("#nestable").nestable("serialize"))),t.hide_modal_loading(e)},error:function(i,a,n){alert(n),t.hide_modal_loading(e)}}),!1}}),$("input[name=type]").change(function(){$(".menuItemContainer").hide(),$("#pageID").rules("remove"),$("#href").rules("remove");var t=$("input[name=type]:checked").val();1==t?($(".menuItemPageContainer").show(300),$("#pageID").rules("add",{required:!0})):2==t&&($(".menuItemHrefContainer").show(300),$("#href").rules("add",{required:!0,url:!0}))}),$("input[name=type]").change()};var tpjc=tpjc||{};tpjc.append_page_version_block=function(t,e){this.tLog("- - - append_pageVersion_block()");var i="pageVersionBlockID="+t+"&pageVersionID="+e;$.ajax({type:"POST",url:"ajax/getPageVersionPanel.php",data:i,dataType:"html",cache:!1,success:function(t){$("#sortable").append(t)},error:function(t,e,i){alert(i)}})},tpjc.attach_add_page_version_block_modal=function(){var t=this;t.tLog("- - attach_add_page_version_block_modal()"),t.set_validator_defaults();var e="addPageVersionBlockModal",i=e+"Form";$("#"+i).validate({submitHandler:function(i){return t.tLog("- - - add block submit"),t.modal_ajax_submit_handler(e,function(e){if("undefined"!=typeof e.isModule&&0===e.isModule){var i="/admin/pageVersionBlock/edit/"+e.pageVersionBlockID+"?pageVersionID="+e.pageVersionID;window.location.href=i}else t.append_page_version_block(e.pageVersionBlockID,e.pageVersionID)}),!1}}),$("#"+e).on("hide.bs.modal",function(){t.tLog("resetting form"),modal=$("#"+e),modal.find('input[name="isRepeating"]').prop("checked")&&(t.tLog("checkbox checked"),modal.find('input[name="isRepeating"]').prop("checked",!1),$("#tpjc_repeatingCheckBox").collapse("hide")),modal.find("input:text, select, textarea").val(""),modal.find("input:radio").removeAttr("checked").removeAttr("selected"),modal.find(".modalMessageContainer").html(""),modal.find('radio[name="templateID"]').first().click(),modal.find("ul.nav li a").first().click()}),"undefined"!=typeof t.options.triggerPageVersionBlockModal&&(t.tLog("triggering modal on first launch"),$("#"+e).modal("show"))},tpjc.attach_insert_page_version_block_modal=function(){var t=this;t.tLog("- - attach_insert_page_version_block_modal()"),t.set_validator_defaults();var e="insertPageVersionBlockModal";$("#"+e).children("form").validate({rules:{pageVersionBlockID:"required"},submitHandler:function(i){return t.modal_ajax_submit_handler(e,function(e){t.append_page_version_block(e.pageVersionBlockID,e.pageVersionID),t.show_message("success",e.message)}),!1}})},tpjc.attach_remove_page_version_block=function(){this.tLog("- - attach_remove_page_version_block()");var t=this;$('a[data-tpjc-action="remove_page_version_block"]').click(function(){if(confirm("Are you sure?")){var e=$(this),i=(e.data("tpjc-dumb-id"),e.data("tpjc-page-version-id")),a=e.data("tpjc-page-version-block-id");"undefined"!=i&&"undefined"!=a?$.ajax({type:"POST",url:"pageVersionBlock.php",data:"&mode=deleteBlockLink&pageVersionBlockID="+a+"&pageVersionID="+i+"&isAjax=1",dataType:"json",cache:!1,success:function(t){$("#pageVersionBlockID_"+t.pageVersionBlockID).fadeOut(600,function(){$(this).remove()})},error:function(t,e,i){alert(i)}}):t.tLog("pageVersionID = undefined or pageVersionBlockID = undefined")}return!1})},tpjc.attach_page_version_block_sortable=function(){this.tLog("- - attach_page_version_block_sortable()");var t=this;$("#sortable").length>1?$("#sortable").sortable({placeholder:"dropZone",items:"> .panel",handle:".tpjc_dragHandle",update:function(t,e){var i=$("#editForm").find('input[name="pageVersionID"]').val(),a=$("#sortable").sortable("serialize")+"&pageVersionID="+i;$.ajax({type:"POST",url:"ajax/editPageVersionBlockRank.php",data:a,success:function(t){},error:function(t,e,i){alert(i)}})}}):t.tLog("WARNING - nothing to sort")};var tpjc=tpjc||{};tpjc.attach_admin_user_change_password=function(){this.tLog("- attach_admin_user_change_password()"),$('#editForm input[name="password1"]').val(""),$('#editForm input[name="password2"]').val(""),this.options.validateRules={rules:{password1:"required",password2:{equalTo:"#password1"}}}},tpjc.attach_account_user_change_password=function(){this.tLog("- attach_account_user_change_password() - YES"),$('#editForm input[name="password1"]').val(""),$('#editForm input[name="password2"]').val(""),this.options.validateRules={rules:{password1:"required",password2:{equalTo:"#password1"}}}},tpjc.attach_add_account_user_modal=function(){t=this,t.tLog("- attach_add_account_user_modal()"),this.tLog("- attach_faq_tag_modal()");var t=this,e="addAccountUserModal";$("#"+e).children("form").validate({rules:{accountUserGroupID:"required"},submitHandler:function(i){return t.modal_ajax_submit_handler(e,function(t){var i="";i+='<tr><td class="tableControlColumn"><a href="accountUser.php?mode=edit&accountUserID='+t.accountUserID+'"><i class="glyphicon glyphicon-pencil"></i></a></td><td>'+t.firstName+" "+t.lastName+"</td><td>"+t.email+'</td><td class="tableControlColumn"><a href="#" class="tpjc_removeAccountUser" data-account-user-id="'+t.accountUserID+'" data-tag-id="'+t.tagID+'" onClick="return confirm(\'Are you sure you want to remove this user?\');"><i class="glyphicon glyphicon-remove delete"></i></a></td></tr>',$("#tpjc_accountUserTable").append(i),$("#"+e).find(".tpjc_searchSelect").val("").trigger("chosen:updated")}),!1}})},tpjc.attach_account_user_group_remove=function(){self=this,self.tLog("- attach_account_user_group_remove()"),$("body").on("click",".tpjc_removeAccountUser",function(){var t=$(this),e=t.data("account-user-id"),i=t.data("tag-id");return $.ajax({type:"POST",url:"accountUserGroup.php",data:"&mode=deleteLink&accountUserID="+e+"&tagID="+i,dataType:"json",cache:!1,success:function(e){return t.parents("tr").first().fadeOut(300,function(){$(this).remove()}),!1},error:function(t,e,i){alert(i)}}),!1})},tpjc.attach_admin_user_add_validate=function(){self=this,self.tLog("- attach_admin_user_add_validate"),$("#tpjc_useTemp").change(function(){$(this).is(":checked")?(self.tLog("- removing password require"),$('input[name="password"]').rules("remove")):(self.tLog("- now requiring password"),$('input[name="password"]').rules("add",{required:!0}))})};